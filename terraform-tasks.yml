parameters: 
  rgName: "Default Resource Group"
  containerName: "Default Container"
  saName: "Default Storage account"
  key: "Default Key"
  subscriptionId: "Default Subscription ID"
  clientId: "Default App ID"
  tenantId: "Default Tenant ID"
  clientSecret: "Default App password"
  terraformPlan: "Decides if goes to the 2 jobs or nah"
steps:
  - bash: |
      az login --service-principal -u ${{ parameters.clientId }} -p ${{ parameters.clientSecret }} --tenant ${{ parameters.tenantId }}
      terraform init -reconfigure -backend-config="container_name=${{ parameters.containerName }}" \
      -backend-config="storage_account_name=${{ parameters.saName }}" \
      -backend-config="subscription_id=${{ parameters.subscriptionId }}" \
      -backend-config="tenant_id=${{ parameters.tenantId }}" \
      -backend-config="client_id=${{ parameters.clientId }}" \
      -backend-config="client_secret=${{ parameters.clientSecret }}" \
      -backend-config="resource_group_name=${{ parameters.rgName }}" \
      -backend-config="key=${{ parameters.key }}" \
      -input=false
  - bash: |
          az login --service-principal -u ${{ parameters.clientId }} -p ${{ parameters.clientSecret }} --tenant ${{ parameters.tenantId }}
          terraform plan -out=tfplan -var "location=${{ parameters.location }}" \
          -var "env=${{ parameters.env }}" \
          -var "owner=${{ parameters.owner }}" \
          -var "sourceip=${{ parameters.sourceip }}" \
          -var "password=${{ parameters.password }}" \
          -input=false
    condition: eq('${{ parameters.terraformPlan}}', 'true')

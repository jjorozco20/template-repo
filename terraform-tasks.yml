parameters: 
  rgName: "Default Resource Group"
  containerName: "Default Container"
  saName: "Default Storage account"
  key: "Default Key"
  subscriptionId: "Default Subscription ID"
  clientId: "Default App ID"
  tenantId: "Default Tenant ID"
  clientSecret: "Default App password"
steps:
  - pwsh: ./Configure-ServicePrincipal.ps1
    displayName: Configure Service Principal
    env: 
      ARM_RG_NAME: ${{ parameters.rgName }}
      ARM_SA_NAME: ${{ parameters.saName }}
      ARM_CLIENT_ID: ${{ parameters.clientId }}
      ARM_TENANT_ID: ${{ parameters.tenantId }}
      ARM_CLIENT_SECRET: ${{ parameters.clientSecret }}
      ARM_CONTAINER_NAME: ${{ parameters.containerName }}
  - bash: |
      terraform init -reconfigure -backend-config="container_name=${{ parameters.ARM_CONTAINER_NAME }}" \
      -backend-config="storage_account_name=${{ parameters.ARM_SA_NAME }}" \
      -backend-config="subscription_id=${{ parameters.ARM_SUBSCRIPTION_ID }}" \
      -backend-config="tenant_id=${{ parameters.ARM_TENANT_ID }}" \
      -backend-config="client_id=${{ parameters.ARM_CLIENT_ID }}" \
      -backend-config="client_secret=${{ parameters.ARM_CLIENT_SECRET }}" \
      -backend-config="resource_group_name=${{ parameters.ARM_RG_NAME }}" \
      -backend-config="key=${{ parameters.ARM_KEY }}" \
      -input=false
